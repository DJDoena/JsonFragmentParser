using System.Collections.Generic;
using System.Diagnostics;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Newtonsoft.Json;

namespace DoenaSoft.JsonFragmentParser.Tests;

[TestClass]
public sealed class JsonTreeTests
{
    [TestMethod]
    public void ObjectNormal()
    {
        const string Input = "{ \"Name\":\"DJ\" }";

        var cleaned = EndOfJsonParserTests.Clean(Input);

        var rootNode = JsonTreeBuilder.Build(cleaned);
    }

    [TestMethod]
    public void RootList()
    {
        var source = new List<Person>()
        {
            new() { Name = "DJ" },
            new() { Name = "Doena" },
        };

        var input = JsonConvert.SerializeObject(source);

        var cleaned = EndOfJsonParserTests.Clean(input);

        var rootNode = JsonTreeBuilder.Build(cleaned);
    }

    [TestMethod]
    public void AnonymousRootList()
    {
        var source = new[]
        {
            new { Name= "DJ" },
            new { Name= "Doena" },
        };

        var input = JsonConvert.SerializeObject(source);

        var cleaned = EndOfJsonParserTests.Clean(input);

        var rootNode = JsonTreeBuilder.Build(cleaned);
    }

    [TestMethod]
    public void List()
    {
        const string Input = "{ \"items\": [ { \"Name\":\"DJ\" }, { \"Name\":\"Doena\" } ] }";

        var cleaned = EndOfJsonParserTests.Clean(Input);

        var rootNode = JsonTreeBuilder.Build(cleaned);
    }

    [TestMethod]
    public void Soundtrack()
    {
        const string Input = "{\"items\":\t[{\"id\":\"sn0698388\",\"rowTitle\":\"Tonight I'm Gonna Rock You Tonight\",\"listContent\":[{\"html\":\"(uncredited)\"}\t,{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"}\t,{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true}\t\t\t,{\"id\":\"sn0698389\",\"rowTitle\":\"Gimme Some Money\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698390\",\"rowTitle\":\"Big Bottom\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698391\",\"rowTitle\":\"All the Way Home\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e and \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e and \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698392\",\"rowTitle\":\"Hell Hole\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698393\",\"rowTitle\":\"Cups and Cakes\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"},{\"html\":\"Arranged by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0172339/?ref_=ttsnd\\\"\\u003eHarlan Collins\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e and \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698394\",\"rowTitle\":\"Heartbreak Hotel\",\"listContent\":[{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm1505678/?ref_=ttsnd\\\"\\u003eMae Boren Axton\\u003c/a\\u003e (as Mae Axton), \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm1509801/?ref_=ttsnd\\\"\\u003eTommy Durden\\u003c/a\\u003e and \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0000062/?ref_=ttsnd\\\"\\u003eElvis Presley\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e (uncredited)\"},{\"html\":\"Copyright 1956 by Tree Publishing Co. Inc. Used by permission.\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698395\",\"rowTitle\":\"(Listen to The) Flower People\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698396\",\"rowTitle\":\"Rock \\u0026 Roll Creation\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698397\",\"rowTitle\":\"Heavy Duty\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698398\",\"rowTitle\":\"Stonehenge\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698399\",\"rowTitle\":\"Sex Farm\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001661/?ref_=ttsnd\\\"\\u003eRob Reiner\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698400\",\"rowTitle\":\"Jazz Odyssey\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e and \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e and \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698401\",\"rowTitle\":\"Lick My Love Pump\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698402\",\"rowTitle\":\"The Mule Died\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn0698403\",\"rowTitle\":\"A Grateful Nation\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Written by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0571106/?ref_=ttsnd\\\"\\u003eMichael McKean\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001302/?ref_=ttsnd\\\"\\u003eChristopher Guest\\u003c/a\\u003e, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0733427/?ref_=ttsnd\\\"\\u003eHarry Shearer\\u003c/a\\u003e\"},{\"html\":\"Performed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm2346967/?ref_=ttsnd\\\"\\u003eSpinal Tap\\u003c/a\\u003e\"}],\"expandLimit\":6,\"stackedListItem\":true},{\"id\":\"sn1499915\",\"rowTitle\":\"Minuet from String Quintet in E major, G.275\",\"listContent\":[{\"html\":\"(uncredited)\"},{\"html\":\"Composed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0090530/?ref_=ttsnd\\\"\\u003eLuigi Boccherini\\u003c/a\\u003e\"},{\"html\":\"[Played at the end of \\u0026quot;Heavy Duty\\u0026quot;]\"}],\"expandLimit\":6,\"stackedListItem\":true}],\"total\":17,\"endCursor\":\"c24xNDk5OTE1\"}";

        var cleaned = EndOfJsonParserTests.Clean(Input);

        var rootNode = JsonTreeBuilder.Build(cleaned);

        var itemsNode = rootNode["items"];

        var itemsItem = itemsNode[0];

        var rowTitleItem = itemsItem["rowTitle"];

        Assert.IsNotNull(rowTitleItem);
        Assert.AreEqual("Tonight I'm Gonna Rock You Tonight", rowTitleItem.ValueAsString);

        var listContentItem = itemsItem["listContent"];

        Assert.IsNotNull(listContentItem);

        foreach (var contentItem in listContentItem)
        {
            foreach (var htmlItem in contentItem)
            {
                Assert.IsNotNull(htmlItem?.ValueAsString);
                Assert.IsInstanceOfType(htmlItem.ValueAsString, typeof(string));

                Debug.WriteLine(htmlItem.ValueAsString);
            }
        }
    }

    [TestMethod]
    public void Goofs()
    {
        const string Input = "[{\"id\":\"continuity\",\"name\":\"Continuity\",\"section\":{\"items\":[{\"id\":\"gf0975237\",\"cardHtml\":\"In the initial fight scene, The Samurai cuts the first two adversaries in the mid-section, then slices the last man\\u0026#39;s arm off. That last man is first seen from behind holding the sword in his right arm above his head, but the arm holding the sword shown moments later is a left arm.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=gf0975237\"},\"userVotingProps\":{\"itemType\":\"Goof\",\"upVotes\":10,\"downVotes\":0,\"itemConst\":\"gf0975237\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"ttgf\"}}],\"total\":1,\"endCursor\":\"Z2YwOTc1MjM3\"},\"spoilerSection\":{\"items\":[],\"total\":0,\"endCursor\":null}},{\"id\":\"revealing_mistake\",\"name\":\"Revealing mistakes\",\"section\":{\"items\":[{\"id\":\"gf0804167\",\"cardHtml\":\"When Sanjuro practices throwing the knife at a leaf, the wire on the knife is clearly visible (the scene was filmed backwards; the knife was actually pulled off the leaf by the wire).\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=gf0804167\"},\"userVotingProps\":{\"itemType\":\"Goof\",\"upVotes\":12,\"downVotes\":3,\"itemConst\":\"gf0804167\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"ttgf\"}},{\"id\":\"gf0982507\",\"cardHtml\":\"The interval between the noise of the gunshot and the ringing of bell is too long.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=gf0982507\"},\"userVotingProps\":{\"itemType\":\"Goof\",\"upVotes\":9,\"downVotes\":4,\"itemConst\":\"gf0982507\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"ttgf\"}},{\"id\":\"gf2136937\",\"cardHtml\":\"The 2:00 AM meeting between the gangs was clearly filmed in broad daylight.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=gf2136937\"},\"userVotingProps\":{\"itemType\":\"Goof\",\"upVotes\":11,\"downVotes\":6,\"itemConst\":\"gf2136937\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"ttgf\"}},{\"id\":\"gf0982506\",\"cardHtml\":\"The wire used to pull the Yakuza\\u0026#39;s cut kimono off can be seen as he gets up from the ground.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=gf0982506\"},\"userVotingProps\":{\"itemType\":\"Goof\",\"upVotes\":5,\"downVotes\":2,\"itemConst\":\"gf0982506\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"ttgf\"}},{\"id\":\"gf2987433\",\"cardHtml\":\"When Sanjuro smites his opponent\\u0026#39;s arm off, the arm can be seen moving under the poncho.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=gf2987433\"},\"userVotingProps\":{\"itemType\":\"Goof\",\"upVotes\":3,\"downVotes\":4,\"itemConst\":\"gf2987433\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"ttgf\"}}],\"total\":5,\"endCursor\":\"Z2YyOTg3NDMz\"},\"spoilerSection\":{\"items\":[],\"total\":0,\"endCursor\":null}}]},\"requestContext\"";

        var cleaned = EndOfJsonParserTests.Clean(Input);

        var rootNode = JsonTreeBuilder.Build(cleaned);

        var itemsItem = rootNode[0];

        var nameItem = itemsItem["name"];

        Assert.IsNotNull(nameItem);

        GoofItems(itemsItem["section"]);

        GoofItems(itemsItem["spoilerSection"]);
    }

    private static void GoofItems(JsonNode sectionItem)
    {
        if (sectionItem == null)
        {
            return;
        }

        var itemsNode = sectionItem["items"];

        Assert.IsNotNull(itemsNode);

        foreach (var itemsItem in itemsNode)
        {
            var htmlItem = itemsItem["cardHtml"];

            Assert.IsNotNull(htmlItem);

            Assert.IsNotNull(htmlItem.ValueAsString);
        }
    }

    [TestMethod]
    public void Trivia()
    {
        const string Input = "[{\"id\":\"uncategorized\",\"section\":{\"items\":[{\"id\":\"tr0650949\",\"cardHtml\":\"\\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0000041/?ref_=tttrv_tr\\\"\\u003eAkira Kurosawa\\u003c/a\\u003e told \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001536/?ref_=tttrv_tr\\\"\\u003eToshirô Mifune\\u003c/a\\u003e that his character was like a wolf or a dog and told \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0619938/?ref_=tttrv_tr\\\"\\u003eTatsuya Nakadai\\u003c/a\\u003e that his character was like a snake. Inspired by this direction, Mifune came up with Sanjuro\\u0026#39;s trademark shoulder twitch, similar to the way a dog or wolf tries to get off fleas.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr0650949\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":244,\"downVotes\":1,\"itemConst\":\"tr0650949\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}},{\"id\":\"tr2397428\",\"cardHtml\":\"\\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001466/?ref_=tttrv_tr\\\"\\u003eSergio Leone\\u003c/a\\u003e was inspired by this film and made the famous \\u0026quot;spaghetti western\\u0026quot; \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/title/tt0058461/?ref_=tttrv_tr\\\"\\u003eFür eine Handvoll Dollar (1964)\\u003c/a\\u003e with a similar plot. However, because Leone did not officially get permission to remake this film, which was copyrighted, \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0000041/?ref_=tttrv_tr\\\"\\u003eAkira Kurosawa\\u003c/a\\u003e sued him and delayed the release for three years. Leone paid him a sum plus 15% of the profits. Interestingly enough, Kurosawa himself stated that he based his movie on \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/title/tt0034798/?ref_=tttrv_tr\\\"\\u003eDer gläserne Schlüssel (1942)\\u003c/a\\u003e, an adaptation of \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0358591/?ref_=tttrv_tr\\\"\\u003eDashiell Hammett\\u003c/a\\u003e\\u0026#39;s novel, without officially crediting either source. However, various critics and readers of Hammett\\u0026#39;s work have noted that Yojimbo\\u0026#39;s overall plot is closer to Hammett\\u0026#39;s \\u0026quot;Red Harvest\\u0026quot; and not \\u0026quot;The Glass Key.\\u0026quot;\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr2397428\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":293,\"downVotes\":2,\"itemConst\":\"tr2397428\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}},{\"id\":\"tr3196660\",\"cardHtml\":\"Yojimbo was an obvious inspiration for Sergio Leone\\u0026#39;s classic A Fistful of Dollars (1964) although it was not credited as the source material for the film. Walter Hill, however, also remade Yojimbo years later as \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/title/tt0116830/?ref_=tttrv_tr\\\"\\u003eLast Man Standing (1996)\\u003c/a\\u003e starring \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0000246/?ref_=tttrv_tr\\\"\\u003eBruce Willis\\u003c/a\\u003e, and credited Kurosawa\\u0026#39;s film as the original source. All three films follow a similar plot, although each takes place in a far different setting and time in human history.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr3196660\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":96,\"downVotes\":0,\"itemConst\":\"tr3196660\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}},{\"id\":\"tr0625025\",\"cardHtml\":\"Although the most common meaning of the word \\u0026quot;Yôjinbô\\u0026quot; is \\u0026quot;bodyguard\\u0026quot;, the etymological origin of the characters (kanji) meant a stick or pole used for self-defense. Depending on the context, it can also mean a \\u0026quot;bar\\u0026quot; (e.g. on a door) or a \\u0026quot;bolt\\u0026quot;, or instead of bodyguard, it can mean \\u0026quot;security\\u0026quot;, \\u0026quot;guard\\u0026quot; or \\u0026quot;watchman\\u0026quot;, always in the sense of \\u0026quot;protector\\u0026quot;.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr0625025\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":204,\"downVotes\":3,\"itemConst\":\"tr0625025\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}},{\"id\":\"tr1687189\",\"cardHtml\":\"\\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0000041/?ref_=tttrv_tr\\\"\\u003eAkira Kurosawa\\u003c/a\\u003e asked his sound engineer \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0590988/?ref_=tttrv_tr\\\"\\u003eIchirô Minawa\\u003c/a\\u003e to come up with a sound effect to be used when a sword is cutting, and killing, someone. After testing out slicing a sword into beef and pork, he finally found the perfect sample: putting two wooden chopsticks inside a raw chicken, then hacking it with a sword.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr1687189\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":192,\"downVotes\":4,\"itemConst\":\"tr1687189\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}}],\"total\":28,\"endCursor\":\"dHIxNjg3MTg5\"},\"spoilerSection\":{\"items\":[{\"id\":\"tr0657973\",\"cardHtml\":\"\\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0000041/?ref_=tttrv_tr\\\"\\u003eAkira Kurosawa\\u003c/a\\u003e challenged his assistant directors to come up with an image for the film to let Sanjuro know he was entering a bad town. He shot down all of their ideas, since all of them had already been done. Kurosawa himself then came up with the idea of the dog carrying the human hand.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr0657973\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":310,\"downVotes\":1,\"itemConst\":\"tr0657973\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}},{\"id\":\"tr0659435\",\"cardHtml\":\"This is an uncredited film version of \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0358591/?ref_=tttrv_tr\\\"\\u003eDashiell Hammett\\u003c/a\\u003e\\u0026#39;s novel \\u0026quot;Red Harvest\\u0026quot;, which has never been officially filmed. It is about a detective who comes to a small city and pits both sides in a gang war against each other until both are almost completely wiped out. The scenes where \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001536/?ref_=tttrv_tr\\\"\\u003eToshirô Mifune\\u003c/a\\u003e\\u0026#39;s character is held and beaten, however, were taken from Hammett\\u0026#39;s novel \\u0026quot;The Glass Key\\u0026quot;, which has been adapted for the screen twice.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr0659435\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":115,\"downVotes\":2,\"itemConst\":\"tr0659435\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}},{\"id\":\"tr0651379\",\"cardHtml\":\"The massive amount of dust seen being blown about was actually imported by the truckload from an abandoned firing range. When the wind machines started, it was nearly impossible for the actors to keep their eyes open because they were being engulfed in the dust. When \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0619938/?ref_=tttrv_tr\\\"\\u003eTatsuya Nakadai\\u003c/a\\u003e was shooting his death scene, over the course of three days, the combination of the fake blood and the blowing dust made him break out in hives that lasted for weeks after filming.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr0651379\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":102,\"downVotes\":2,\"itemConst\":\"tr0651379\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}},{\"id\":\"tr0659636\",\"cardHtml\":\"In one scene the samurai shows incredible skill at knife-throwing by impaling a blowing leaf against a wooden floor. This was accomplished by running the shot backwards. In the frame before the knife hits the leaf, you can see a slit in the leaf the same size and at the exact point where the knife penetrates it a frame later.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr0659636\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":150,\"downVotes\":5,\"itemConst\":\"tr0659636\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}},{\"id\":\"tr3248496\",\"cardHtml\":\"When asked his name, the samurai calls himself Sanjuro Kuwabatake. He makes up this name while looking at a mulberry field near the town. Thus, the character can be viewed as an early example of the Man with No Name from the Dollars series of westerns directed by \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0001466/?ref_=tttrv_tr\\\"\\u003eSergio Leone\\u003c/a\\u003e starring \\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0000142/?ref_=tttrv_tr\\\"\\u003eClint Eastwood\\u003c/a\\u003e.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr3248496\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":109,\"downVotes\":3,\"itemConst\":\"tr3248496\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}}],\"total\":8,\"endCursor\":\"dHIzMjQ4NDk2\"}},{\"id\":\"director-trademark\",\"name\":\"Director Trademark\",\"section\":{\"items\":[{\"id\":\"tr2170115\",\"cardHtml\":\"\\u003ca class=\\\"ipc-md-link ipc-md-link--entity\\\" href=\\\"/name/nm0000041/?ref_=tttrv_tr\\\"\\u003eAkira Kurosawa\\u003c/a\\u003e: [weather] Like in most Kurosawa films, rainy weather is present in a few scenes, increasing the effect of the characters\\u0026#39; discomfort. The windy weather all throughout the film represents the chaotic life in the town.\",\"shouldExpandHtmlContent\":true,\"shareButtonProps\":{\"url\":\"?item=tr2170115\"},\"userVotingProps\":{\"itemType\":\"TitleTrivia\",\"upVotes\":152,\"downVotes\":2,\"itemConst\":\"tr2170115\",\"pageConst\":\"tt0055630\",\"refTagPrefix\":\"tttrv\"}}],\"total\":1,\"endCursor\":\"dHIyMTcwMTE1\"},\"spoilerSection\":{\"items\":[],\"total\":0,\"endCursor\":null}}]},\"requestContext\"";

        var cleaned = EndOfJsonParserTests.Clean(Input);

        var rootNode = JsonTreeBuilder.Build(cleaned);
    }
}